<title>{{asignatura}} {{clave}} - Inicio - Seguimiento de Estudiantes</title>
<div class="row-cols-1 m-2">
    <h2 class="display-5">Resumen del {{#if alumno}}alumno{{/if}}{{#if equipo}}equipo{{/if}}</h2>
</div>
<div class="row flex-grow-1 flex-shrink-0">
    <nav id="sideBar" class="col-md-3 col-lg-2 d-md-block sidebar navbar-nav-scroll">
        <div class="sidebar-sticky">
            <h4 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                Temas</h4>
            <ul class="nav flex-column">
                {{#each temas}}
                    <li class="nav-item"><a class="nav-link"
                        {{#if ../alumno}}
                                            href="/grupo-inicio/alumno/{{../idgrupo}}/{{dataValues.id}}/{{../alumno.dataValues.id}}"
                        {{else}}
                                            href="/grupo-inicio/equipo/{{../idgrupo}}/{{dataValues.id}}/{{../equipo.dataValues.id}}"
                        {{/if}}><i class="bi-book-half"></i><strong> {{dataValues.nombre}}</strong></a></li>
                {{/each}}
                {{#if alumno}}
                    <li class="nav-item"><a class="nav-link" href="/grupo/vista-general/{{idgrupo}}/{{alumno.dataValues.id}}"><i class="bi-book-half"></i><strong> Todos</strong></a></li>
                {{else}}
                    <li class="nav-item"><a class="nav-link" href="/grupo/vista-general-equipo/{{idgrupo}}/{{equipo.dataValues.id}}"><i class="bi-book-half"></i><strong> Todos</strong></a></li>
                {{/if}}
            </ul>
        </div>
    </nav>
    <main class="col col-md col-xl col-sm col-lg">
        <div class="row">
            <div class="col">
                <span>
                    <a style="font-size: 1.75rem;font-weight: 500;line-height: 1.2; margin-bottom: 0.5rem;"
                            {{#if alumno}}
                                {{#if tema}}
                                    href="/grupo-inicio/alumnos/{{idgrupo}}/{{idtema}}"
                                {{else}}
                                    href="/grupo-inicio/lista/alumnos/{{idgrupo}}"
                                {{/if}}>
                            {{else}}
                                {{#if tema}}
                                    href="/grupo-inicio/equipos/{{idgrupo}}/{{tema.dataValues.id}}"
                                {{else}}
                                    href="/grupo-inicio/lista/equipos/{{idgrupo}}"
                                {{/if}}>
                            {{/if}}
                        <i class="bi bi-arrow-left-circle-fill" style="size:1.75rem;"></i>
                    </a>
                </span>
                <a style="font-size: 1.75rem;font-weight: 500;line-height: 1.2; margin-bottom: 0.5rem;">Tema: {{tema.dataValues.nombre}}{{title}}  {{equipo.dataValues.nombre}}</a>
            </div>
        </div>

        {{#if alumno}}
            <!-- Datos personales del alumno -->
            <div class="row">
                <div class="col">
                    <div class="card">
                        <div class="card-header">
                            <div class="row">
                                <div class="col">
                                    <h4><i class="bi bi-file-person-fill"></i> Datos del Alumno</h4>
                                </div>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col">

                                    <label for="nombre" class="form-label col-form-label-sm">Apellidos y
                                        Nombre(s)</label>
                                    <input type="text" class="form-control form-control-sm" disabled

                                           name="nombre"
                                           id="nombre" value="{{alumno.dataValues.nombre}}" required>
                                </div>
                            </div>
                            <div class="row ">
                                <div class="col col-xl col-lg col-sm col-md">
                                    <label for="clave" class="form-label col-form-label-sm">Clave</label>
                                    <input type="text" class="form-control form-control-sm" disabled
                                           id="clave"
                                           name="clave"
                                           value="{{alumno.dataValues.clave}}" required>
                                </div>
                                <div class="col col-xl col-lg col-sm col-md">
                                    <label for="correo"
                                           class="form-label col-form-label-sm disabled">Correo</label>
                                    <input type="email" name="correo" id="correo"
                                           class="form-control form-control-sm" disabled
                                           value="{{alumno.dataValues.correo}}">
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Graficación de los datos -->
            <div class="row-cols-1  m-2 p-2">
                <p>Primera Oportunidad</p>
            </div>
            <div class="row d-flex m-2 p-2">
                <div class="col-4 col-md-5 col-xl-3 col-sm-4 col-lg-3 graph-container">
                        <div class="caption text-center">Indice de Reprobación</div>
                        <input type="hidden" id="indiceReprobacionData" value="{{dataReprobacion}}">
                        <div id="indiceReprobacion" style="width: 100%; height: 250px;">
                        </div>
                        <p>
                            {{#if title}}Temas aprobados{{else}}Actividades aprobadas{{/if}}: {{actAprobadas}}
                        </p>
                        <p>
                            {{#if title}}Temas no aprobados{{else}}Actividades no aprobadas{{/if}}: {{actReprobadas}}
                        </p>
                </div>
                <div class="col col-md col-xl col-sm col-lg graph-container">
                    <div class="caption text-center">Rendimiento en {{#if title}}Temas{{else}}actividades{{/if}}</div>
                    <input type="hidden" id="actividadesReprobacionData" value="{{dataReprobacionAct}}">
                    <div id="actividadesAprobacion" style="width: 90%; height: 250px;"></div>

                </div>
            </div>
            <div class="row-cols-1 m-2 p-2">
                <p>Segunda Oportunidad</p>
            </div>
            <div class="row d-flex m-2 p-2">
                <div class="col-4 col-md-5 col-xl-3 col-sm-4 col-lg-3 graph-container">
                    <div class="caption text-center">Indice de Reprobación</div>
                    <input type="hidden" id="indiceReprobacionDataS2" value="{{dataReprobacionS2}}">
                    <div id="indiceReprobacionS2" style="width: 100%; height: 250px;">
                    </div>
                    <p>
                        {{#if title}}Temas aprobados{{else}}Actividades aprobadas{{/if}}: {{actAprobadasS2}}
                    </p>
                    <p>
                        {{#if title}}Temas no aprobados{{else}}Actividades no aprobadas{{/if}}: {{actReprobadasS2}}
                    </p>
                </div>
                <div class="col col-md col-xl col-sm col-lg graph-container">
                    <div class="caption text-center">Rendimiento en {{#if title}}Temas{{else}}actividades{{/if}}</div>
                    <input type="hidden" id="actividadesReprobacionDataS2" value="{{dataReprobacionActS2}}">
                    <div id="actividadesAprobacionS2" style="width: 90%; height: 250px;"></div>

                </div>
            </div>
            <script type="text/javascript">
                dataReprobacion = document.getElementById("indiceReprobacionData").value;
                dataReprobacionAct = document.getElementById("actividadesReprobacionData").value;
                dataReprobacionS2 = document.getElementById("indiceReprobacionDataS2").value;
                dataReprobacionActS2 = document.getElementById("actividadesReprobacionDataS2").value;
                console.log(JSON.parse(dataReprobacionAct));
                new Morris.Bar({
                    element: "actividadesAprobacion",
                    data: JSON.parse(dataReprobacionAct),
                    xkey:'label',
                    ykeys:['value'],
                    labels: ['Calificación'],
                    resize: true,
                    xLabelAngle: 15,
                    barColors:
                            function (row, series , type) {
                        if(row.y < 70){
                            return '#757575';
                        }
                        else {
                            return '#065CA3';
                        }
                    }

                })
                new Morris.Donut({
                    element: "indiceReprobacion",
                    data: JSON.parse(dataReprobacion),

                    formatter: function (y) {
                        return y + "%"
                    },
                    resize: true,
                    colors: ['#065CA3', '#757575']
                })
                /*Segunda oportunidad*/
                new Morris.Bar({
                    element: "actividadesAprobacionS2",
                    data: JSON.parse(dataReprobacionActS2),
                    xkey: 'label',
                    ykeys: ['value'],
                    labels: ['Calificación'],
                    resize: true,
                    xLabelAngle: 15,
                    barColors:
                            function (row, series, type) {
                                if (row.y < 70) {
                                    return '#757575';
                                } else {
                                    return '#4AA96C';
                                }
                            }
                })

                new Morris.Donut({
                    element: "indiceReprobacionS2",
                    data: JSON.parse(dataReprobacionS2),

                    formatter: function (y) {
                        return y + "%"
                    },
                    resize: true,
                    colors: ['#4AA96C', '#757575']
                })
            </script>
        {{else}}
            <!--Informacion del equipo-->
            <div id='toolbar' class="fixed-table-toolbar">
                Primera Oportunidad
            </div>
            <!--Integrantes, actividades del tema, calificaciones-->
            <div class="row-cols-1 bootstrap4 bootstrap-table fixed-table-container">
                <input type="hidden" id="valorTabla" name="valorTabla" value="{{listaFormateada}}">
                <table id="table" data-toggle="table" data-search="true"
                       data-advanced-search="true" data-filter-control="true" data-toolbar="#toolbar" name="table">
                    <thead>
                    <tr>
                        <th data-field="clave" data-sorteable="false">No. Control</th>
                        <th data-field="nombre" data-sorteable="true">Nombre</th>
                        {{#if actividades}}
                            {{#each actividades}}
                                <th data-field="calificaciones.{{@index}}" class="column">{{dataValues.nombre}}: {{dataValues.valor}}</th>
                            {{/each}}
                            <th data-field="califinal" class="column">Calif. Final</th>
                        {{/if}}
                        {{#if unidad}}
                            {{#each unidad}}
                                <th data-field="calificacion.{{@index}}.califinalPreS2" class="column">{{dataValues.nombre}}</th>
                            {{/each}}
                            <th data-field="califMateria" class="column">Calif. Final</th>
                        {{/if}}
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>

            <div id="toolbarS2" class="fixed-table-toolbar">
                Segunda Oportunidad
            </div>
            <!--Integrantes, actividades del tema, calificaciones-->
            <div class="row-cols-1 bootstrap4 bootstrap-table fixed-table-container">
                <input type="hidden" id="valorTablaS2" name="valorTablaS2" value="{{listaFormateadaS2}}">
                <table id="tableS2" data-toggle="table" data-search="true"
                       data-advanced-search="true" data-filter-control="true" data-toolbar="#toolbarS2" name="tableS2">
                    <thead>
                    <tr>
                        <th data-field="clave" data-sorteable="false">No. Control</th>
                        <th data-field="nombre" data-sorteable="true">Nombre</th>
                        {{#if actividades}}
                            {{#each actividades}}
                                <th data-field="calificaciones.{{@index}}" class="column">{{dataValues.nombre}}: {{dataValues.valor}}</th>
                            {{/each}}
                            <th data-field="califinal" class="column">Calif. Final</th>
                        {{/if}}
                        {{#if unidad}}
                            {{#each unidad}}
                                <th data-field="calificacion.{{@index}}.califinal" class="column">{{dataValues.nombre}}</th>
                            {{/each}}
                            <th data-field="califMateriaS2" class="column">Calif. Final</th>
                        {{/if}}
                    </tr>
                    </thead>
                    <tbody>

                    </tbody>
                </table>
            </div>
            <script type="text/javascript" src="/js/llenar-tablas-equipo-inicio.js">
            </script>
        {{/if}}
    </main>
</div>